(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var e=`http://192.168.0.28:3001/todos`;async function t(){try{let t=await fetch(e),n=await t.json();if(console.log(`Fetched todos:`,t.statusText),!t.ok)throw Error(`API error: ${t.status}`);return localStorage.setItem(`todo-cache`,JSON.stringify(n)),n}catch(e){let t=JSON.parse(localStorage.getItem(`todo-cache`))||[];return console.error(`Failed to fetch todos:`,e),t}}async function n(t){try{let n=await fetch(`${e}/${t}`);if(!n.ok)throw Error(`API error: ${n.status}`);return await n.json()}catch(e){console.error(`Failed to fetch todos:`,e),console.error(`Fallback to Cached data`);let n=(JSON.parse(localStorage.getItem(`todo-cache`))||[]).find(e=>e.id===t);if(n)return n;throw Error(`Todo not found in cache`)}}var r=`post-queue`;function i(){return JSON.parse(localStorage.getItem(r))||[]}function a(e){localStorage.setItem(r,JSON.stringify(e))}async function o(t){try{let n=await fetch(`${e}/`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(t)});if(!n.ok)throw Error(`Failed to add todo`);return n.json()}catch{let n=i();return n.push({url:e,payload:t}),a(n),t}}async function s(){let t=i();if(!t.length)return;let n=[];for(let r of t)try{let t=r.url||e,n=r.payload||r;if(!(await fetch(t,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(n)})).ok)throw Error(`Retry failed`)}catch{n.push(r)}a(n)}async function c(t){let n=await fetch(`${e}/${t.id}`,{method:`PUT`,headers:{"Content-Type":`application/json`},body:JSON.stringify(t)});if(!n.ok)throw Error(`Failed to update todo`);return n.json()}async function l(t){await fetch(`${e}/${t}`,{method:`DELETE`})}var u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));function d(e,t=0){return(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+`-`+u[e[t+4]]+u[e[t+5]]+`-`+u[e[t+6]]+u[e[t+7]]+`-`+u[e[t+8]]+u[e[t+9]]+`-`+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase()}var f,p=new Uint8Array(16);function m(){if(!f){if(typeof crypto>`u`||!crypto.getRandomValues)throw Error(`crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported`);f=crypto.getRandomValues.bind(crypto)}return f(p)}var h={randomUUID:typeof crypto<`u`&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function g(e,t,n){e||={};let r=e.random??e.rng?.()??m();if(r.length<16)throw Error(`Random bytes length must be >= 16`);if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){if(n||=0,n<0||n+16>t.length)throw RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=r[e];return t}return d(r)}function _(e,t,n){return h.randomUUID&&!t&&!e?h.randomUUID():g(e,t,n)}var v=_,y=navigator.onLine,b=document.getElementById(`user`),x=document.getElementById(`user-button`),S=document.getElementById(`status`);document.getElementById(`offline-banner`);var C=document.getElementById(`todo-list`),w=document.getElementById(`task-form`);x.addEventListener(`click`,()=>{document.cookie=`username=${b.value}; path=/; max-age=86400`,alert(`Username set to ${b.value}`),N()}),w.addEventListener(`submit`,async e=>{e.preventDefault();let t=document.getElementById(`todo-input`),n=document.getElementById(`todo-date`);k({title:t.value,dueDate:n.value})}),C.addEventListener(`click`,e=>{console.log(e.target);let t=e.target.closest(`.todo-item`),n=t.dataset.id;console.log(n),console.log(t),e.target.classList.contains(`todo-checkbox`)&&(j(n),console.log(n)),e.target.classList.contains(`todo-delete`)&&A(n)});var T=0,E=10,D=await t().then(()=>O());function O(){P(D.slice(T*E,(T+1)*E)),T++}async function k(e){if(!y){console.log(`Kan inte skapa - offline`);return}await o({id:v(),title:e.title,completed:!1,description:` `,dueDate:e.dueDate}),console.log(e),P()}function A(e){if(!y){console.log(`Kan inte radera - offline`);return}l(e).then(()=>{console.log(`Raderade todo med id:`,e),P()})}async function j(e){console.log(e);let t=await n(e);t&&(t.completed=!t.completed,console.log(`Toggled:`,t.title,`→`,t.completed),await c(t),P())}function M(){let e=document.getElementById(`offline-banner`);console.log(y),y?(S.textContent=`Online`,document.body.className=`online`,e.style.display=`none`):(S.textContent=`Offline`,document.body.className=`offline`,e.style.display=`block`)}function N(){document.cookie.valueOf(`username`)?document.getElementById(`current-user`).textContent=document.cookie.split(`; `).find(e=>e.startsWith(`username=`)).split(`=`)[1]:document.getElementById(`current-user`).textContent=`no-user`}window.addEventListener(`online`,()=>{y=!0,console.log(`Online nu`),S.textContent=`Syncing...`,document.body.className=`sync`,s().then(()=>{setTimeout(()=>{document.body.className=`online`,M(),P()},500)})}),window.addEventListener(`offline`,()=>{y=!1,console.log(`Offline nu`),M()});async function P(e=[]){C.innerHTML+=e.map(e=>`
    <li class="todo-item" data-id="${e.id}">
      <input type="checkbox" class="todo-checkbox" ${e.completed?`checked`:``} />
      <div class="todo-info">
        <span class="todo-title ${e.completed?`completed`:``}">${e.title}</span>
        ${e.dueDate?`<span class="todo-due-date">${e.dueDate}</span>`:``}
      </div>
      <button class="todo-delete">✕</button>
    </li>
  `).join(``)}var F=new IntersectionObserver(e=>{e[0].isIntersecting&&(O(),console.log(`Loading more todos...`))}),I=document.getElementById(`load-trigger`);console.log(I),I&&(console.log(`Loading more todos...`),F.observe(I)),N(),M();